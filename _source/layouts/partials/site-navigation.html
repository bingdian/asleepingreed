{{/* Custom navigation with mobile drawer */}}
<nav class="pt3 pb0 pv2-ns ph3 ph4-ns navigation-font bg-black-05 relative" role="navigation">
  <div class="flex justify-between items-center center">
    <a href="{{ .Site.Home.RelPermalink }}" class="f3 fw7 no-underline mid-gray dim dib">
      {{ with .Site.Params.site_logo }}
        <span class="dib" style="line-height:0;display:inline-flex;align-items:center;">
          <img src="{{ relURL . }}" alt="{{ $.Site.Title }}" height="40" style="height:40px;width:auto;display:block;" loading="lazy" decoding="async" />
        </span>
      {{ else }}
        {{ .Site.Title }}<span class="black-50">.</span>
      {{ end }}
    </a>

    {{/* Mobile hamburger */}}
    <button id="menuToggle" aria-label="Menu" class="dn-l pointer bg-transparent bn mid-gray dim flex items-center" style="font-size:1.75rem;">
      <span style="display:inline-block;width:28px;height:2px;background:#555;position:relative;">
        <span style="position:absolute;left:0;top:-8px;width:28px;height:2px;background:#555;"></span>
        <span style="position:absolute;left:0;top:8px;width:28px;height:2px;background:#555;"></span>
      </span>
    </button>

    <div class="flex-l items-center dn db-l" id="desktopNav">
      {{ partial "i18nlist.html" . }}
      {{ if .Site.Menus.main }}
      <ul class="pl0 mr3 flex items-center ma0">
        {{ range .Site.Menus.main }}
          <li class="list pv2 mh2 f6 f5-ns fw6 tc dib {{ cond (eq .URL $.RelPermalink) "bb b--black-50" "" }}">
            <a class="gray dim no-underline" href="{{ .URL }}" title="{{ i18n "pageTitle" . }}">{{ .Name }}</a>
          </li>
        {{ end }}
      </ul>
      {{ end }}
      {{ partialCached "social-follow.html" . }}
    </div>
  </div>

  {{/* Drawer overlay */}}
  <!-- Overlay: 初始不拦截点击，通过脚本切换 -->
  <div id="drawerOverlay" class="fixed top-0 left-0 w-100 h-100 bg-black-50 o-0" style="transition:opacity .25s ease; z-index:998; pointer-events:none;"></div>

  <aside id="mobileDrawer" class="fixed top-0 right-0 h-100 bg-near-white shadow-2 w-70 w-50-m w-third-l overflow-y-auto" style="transform:translateX(100%);transition:transform .3s cubic-bezier(.4,0,.2,1); z-index:999;">
    <div class="pa3 bt bl-0 br-0 bb b--black-10 flex items-center justify-between">
      <span class="f4 fw6 mid-gray">{{ .Site.Title }}</span>
      <button id="menuClose" aria-label="Close" class="pointer bg-transparent bn f2 mid-gray dim">×</button>
    </div>
    <div class="pa3">
      {{ partial "i18nlist.html" . }}
      {{ if .Site.Menus.main }}
      <ul class="list pl0 mt2 mb4">
        {{ range .Site.Menus.main }}
          <li class="mv1 {{ cond (eq .URL $.RelPermalink) "bb b--black-50" "" }}">
            <a class="db pv2 ph1 no-underline dark-gray dim fw5" href="{{ .URL }}" title="{{ i18n "pageTitle" . }}">{{ .Name }}</a>
          </li>
        {{ end }}
      </ul>
      {{ end }}
      {{/* 移动端社交链接（原 partial 带 dn db-l 会隐藏，这里单独渲染） */}}
      {{ $socials := where (partialCached "func/socials/Get" "socials/Get") "follow" "!=" false }}
      {{ if $socials }}
      <div class="mt3 mb4">
        <ul class="list pl0 ma0 flex flex-wrap">
          {{ range $socials }}
            <li class="mr3 mb2">
              <a href="{{ .url }}" target="_blank" rel="{{ .rel | default "noopener" }}" class="no-underline dim dark-gray flex items-center" aria-label="{{ .label }} (新窗口打开)">
                {{ with .icon }}<span class="icon mr1" style="display:inline-flex;">{{ . }}</span>{{ end }}
                <span class="f6">{{ .label }}</span>
              </a>
            </li>
          {{ end }}
        </ul>
      </div>
      {{ end }}
      <p class="f7 gray mt5 bt pt3 b--black-10">© {{ now.Format "2006" }} {{ .Site.Title }}</p>
    </div>
  </aside>

  <script>
  (function(){
    var toggle = document.getElementById('menuToggle');
    var closeBtn = document.getElementById('menuClose');
    var drawer = document.getElementById('mobileDrawer');
    var overlay = document.getElementById('drawerOverlay');
    if(!toggle || !drawer) return;
    function open(){
      drawer.style.transform='translateX(0)';
      overlay.style.opacity='1';
      overlay.style.pointerEvents='auto';
      document.documentElement.style.overflow='hidden';
      // 可选：记录触发元素以便关闭后还原焦点
      toggle.setAttribute('aria-expanded','true');
    }
    function close(){
      drawer.style.transform='translateX(100%)';
      overlay.style.opacity='0';
      overlay.style.pointerEvents='none';
      document.documentElement.style.overflow='';
      toggle.setAttribute('aria-expanded','false');
    }
    toggle.addEventListener('click', open);
    overlay.addEventListener('click', close);
    if(closeBtn) closeBtn.addEventListener('click', close);
    document.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
  })();
  </script>

  <style>
    @media (min-width: 60em){ /* matches -l */
      #mobileDrawer, #drawerOverlay, #menuToggle { display:none !important; }
    }
  </style>
</nav>
