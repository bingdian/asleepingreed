{{- $image :=.Destination -}}
{{- $src := .Destination -}}
{{- if eq hugo.Environment "production" -}}
  {{ $src = urls.JoinPath site.Params.cdn .Destination }}
{{- end -}}

{{- if .IsBlock -}}
  <figure>
    <img src="{{$src | safeURL }}"
         {{- with .Text }} alt="{{ . }}" {{ end -}}
    >
    {{- with .Title }}
    <figcaption>{{ . }}</figcaption>
    {{ end -}}
  </figure>
{{- else -}}
  <img src="{{$src | safeURL }}"
       {{- with .Text }} alt="{{ . }}" {{ end -}}
       {{- with .Title }} title="{{ . }}" {{ end -}}
  >
{{- end -}}
